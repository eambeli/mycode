---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVVVVDSkxoTTYvUEhNYzhYY0ZNc1drWWJyVjFzd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTWpBd05ESTNNVGt4TlRBd1doY05NakV3TkRJM01Ua3gKTlRBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUN0dGZ1SEFmeGVmcThEejF3cnZsZmhGZmE5R25adjJKbzRCRkZrWXFYbi80dnRscHY1Yi9hcgpCUjFiS1dTMEZQTGlNeFZRZVNFaFcxSGRZQm1pR21kY2xIWk4zTi9iSXdDR29IK241ZnRXQmh0bGZJU2YyZ0RHCi8zVFJzbEhlelhtUElTUGg4Y1JUYytKSE9MZFFtR0QwdjdnRm0zdndLdmdSbG9ncnVaczUwUlN5MlJjVUVpNTEKYjlYSHh5TjhXcFJWcUdIQmhaa2RGUHBUTXYzSTl0cjlLUkV2R2JLZGFHVXcvQndvaklRcERnUmJNYzVHaFhJOQp3Nkg3RnFMbWRpSmJKamVBemNkbnpDVGRxNm13ZTY1cVRveXRyVVB5akF0UHZQbytOS3h3a1ExT3ZwbVpVcUJFCkVoeW00cmpYQ0ZOREZDQlE0d2kzUkcwdFRmZzJwZytkQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlJ0R0V3QVZ4WGpQS2ZNaVppeGdqL2pCL3V0T1RBZkJnTlZIU01FR0RBV2dCUjM5Sk40ClMvTHp2YUN3TnlTUnF2bTFYTFBlNlRBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBQzMybEkwQkdkR3NiakRMVDV2eTZWTUpiL2pGMitnV3dCYnhzNGJDcW82WQozbkZONWlMR2RtaDVRa0M2aG1pSUZkVGwxZW96VWp4S3I0NUZLUXZLVyt6QWNCOEhmWnRYQm1iYk5zNGVUdFg4ClpreEczT0VuUG4zekYvNkxQTG5RQ285a250Y1hsWUVNOU5wTjlUckwxSFluOU9naStCZlNEblQvU2U1TENYU0QKVzlPaDdwYzVXL1RuWElOTDl6eGZxNjROV2RpNSt2KzA5bHBtaStZZXZOcmFjSis4Z2lhUlhBWU56KzNCSkNCUQpObkxuS0o2bDVyRlQwZzh2OGwyVTNka3ptOG9iRW9tWkNXQ2x2WEM0WDlFMTJyN0lKVkhrOExsODhkRlRnMENhCmNmbnFYZTZOeUFpR2JlSlRrUFJkaGkraGQvZmxKREpXZGtoOWprTjFFaTQ9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBcmJYN2h3SDhYbjZ2QTg5Y0s3NVg0UlgydlJwMmI5aWFPQVJSWkdLbDUvK0w3WmFiCitXLzJxd1VkV3lsa3RCVHk0ak1WVUhraElWdFIzV0Fab2hwblhKUjJUZHpmMnlNQWhxQi9wK1g3VmdZYlpYeUUKbjlvQXh2OTAwYkpSM3MxNWp5RWo0ZkhFVTNQaVJ6aTNVSmhnOUwrNEJadDc4Q3I0RVphSUs3bWJPZEVVc3RrWApGQkl1ZFcvVng4Y2pmRnFVVmFoaHdZV1pIUlQ2VXpMOXlQYmEvU2tSTHhteW5XaGxNUHdjS0l5RUtRNEVXekhPClJvVnlQY09oK3hhaTVuWWlXeVkzZ00zSFo4d2szYXVwc0h1dWFrNk1yYTFEOG93TFQ3ejZQalNzY0pFTlRyNloKbVZLZ1JCSWNwdUs0MXdoVFF4UWdVT01JdDBSdExVMzROcVlQblFJREFRQUJBb0lCQUhta2wwZWFmMlNZcCt3dQpHQ2hWdVdwWW5Ca2VYOVBBeFhYMnFCeDQ3QjhERjdTL28rZlBuTmR6MUhQVEQ3Ny9jSG93Tlh2TjV3SloxWUVGClc4M2xXWDQrUkg0UDd2NmdpeXk3VmNsNFJrR2VNeThsUENaSVhnVDhQSXpmcDI4elNpMk5rbmdWZWxyS0txbWYKTU5lU2JVcld1b0hLdU1hZEFHd29rcUN6Nzl4U3d5YTFkbkRVUXd0b1pXZWQvU3M1aGZSODdoZFRZK3k4SmdVYgpESmJBbFpydXI2aHZuZjJTR0hySm1xbEx5bEpVMHJ4bG52dlRjK2RCQml4U2tUa1I1RjNieEhpVWFRVDRtSnN5CkR4cXJueHBEc2Z3bVFhZ3dIQXhBZVlBREtFL0RqazJUZEJIYTB2SGdRMGpRa1FnL3Q0bWNOUUV4SXRLOEdBRkQKWThZellLMENnWUVBMFhBbm4wWGgyZFU4dHdHWU1SbEVVb2UzaDlJcGxybWp6TUcxTHN1eGNjSGRFMDlaejl4WQpRcG9hUzlzcFZNR0JYWHFGd0M4TXNDdFFpdkZFeWdtVENPRU05ZUt0cWVhQ2hlZysyTXRTQk56cDZPVlM3Y2cyCkdhd1RFMGtSTms2UURUS3JQMXRhakptWTUxVVlMVEY3V3VhL0JQUEtzZTgzTE84NktVZmR2UjhDZ1lFQTFGUjMKcnNLWlZjMzdxRVB2bTQ1RGpReHpZTGEvelVMVGRMcFlna1lJT015REpySE9WNURuOERsNitMdk10eTYrOGNrego0RmVwd2ltM2REVi9sL2ZaK0o0Qk5tUjFjUWZmOGNZUmJVSk5xTjlXZ05TZU03Tm84bzdGT3lzNGxDVFplb0xmCk5EYThGdzIxVng0Sm5RZUVLMEVZZG9KVUoyUE5DclRpbGczZjM4TUNnWUFKaFNLWDc5SkRWNWtKN0kyaGRiZVEKVk5EMzRJcTVhampTM3Q5QWdFdlJrdkZjcGxlN3hoVlErYlpHU25FSGhFQkFJb2lmNHNPZDRtb24xcTI4elZDYwpyN1lxR3lLdnZXV2pkcG9jdXFsQXhWWHdtelA0MFFmOGhNRGRPSTRLdk9sNVlCcytwd1ZuckxleGxFR2tGRUs2Ck1CRHd4YkFxQkdpcXB6a3FsVFMwR3dLQmdINHQzQm5NcHhhb25CNjRrSkdlajJJb3ZnQUJXaVgreW02WnRyTmsKTHNxaUxtWTJUK3NWdjkrd0tQWGJsS0pmY3pWNFhnMjV5cllKMkcyRXhWaG4vKzZRNXlPTnU0VDZLd2tncllhQwpXbWc2b010YWp0RW1rdjFoL3E5VTFnQ2pqV0lTbDlZTm1PVVNUbXVBL0RHSEgvSWNjdzhxRUJ5QVlIODJVMWpjCjBlZkZBb0dCQUxyWDc1OHVvcDVmWC9SUnMxODJSTWdKWmNNTGlJK3YrWmlYSmFxY2VscDdLRXdHQU9VM2l3dHkKbXpmb2xFZFRzVUNtclkyWDlDSlNVK1B4bWo2TmdST1hCbng3MzJYSkZjSCttY1lMY3NYMUtDWWVBeTA1THVFNApWa0lMdlpqN2lBZkFWbjUySUJIaVpWZnFSWGt1NlJ2Z1ZIalJMVWZ6SjJpb2xSeXFubWt3Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
metadata:
  name: registry-tls
  namespace: default
type: Opaque
